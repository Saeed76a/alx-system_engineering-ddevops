#!/usr/bin/env bash

# Install Nginx web server and create required directories
sudo apt-get update
sudo apt-get install -y nginx
sudo mkdir -p /var/www/my_website
sudo chown -R www-data:www-data /var/www/my_website
sudo chmod -R 755 /var/www

# Create a custom index page
echo "<html><body><h1>Hello, world!</h1></body></html>" | sudo tee /var/www/my_website/index.html

# Create a custom 404 page
echo "<html><body><h1>404 Not Found</h1><p>Sorry, the page you requested was not found on this server.</p></body></html>" | sudo tee /var/www/my_website/404.html

# Configure Nginx to serve our custom pages
sudo tee /etc/nginx/sites-available/my_website <<EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    root /var/www/my_website;
    index index.html;
    error_page 404 /404.html;
    location = /404.html {
        internal;
    }
    add_header X-Served-By \$hostname;
    rewrite ^/redirect_me$ https://www.example.com/ permanent;
}
EOF

sudo ln -s /etc/nginx/sites-available/my_website /etc/nginx/sites-enabled/
sudo service nginx restart
